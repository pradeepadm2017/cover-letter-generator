<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BatchApply - AI-Powered Cover Letter Generator</title>
    <link rel="stylesheet" href="landing-styles.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo">
                <img src="my-design-page-1.png" alt="FastCoverLetters" class="logo-full">
            </div>
            <div class="nav-links">
                <a href="#features">Features</a>
                <a href="#pricing">Pricing</a>
                <button onclick="signInWithGoogle()" class="btn-login">Login</button>
            </div>
        </div>
    </nav>

    <section class="hero">
        <div class="hero-content">
            <p class="hero-subtitle">AI-powered cover letters tailored to each job posting. Save hours of work and apply to more jobs.</p>
            <div class="hero-cta">
                <button onclick="signInWithGoogle()" class="btn-primary btn-large">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" fill="#4285F4"/>
                        <path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"/>
                        <path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" fill="#FBBC05"/>
                        <path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"/>
                    </svg>
                    Get Started with Google
                </button>
            </div>
            <p class="hero-note">Start free - No credit card required</p>
        </div>
    </section>

    <section id="features" class="features">
        <div class="container">
            <h2>Why Choose FastCoverLetters.com?</h2>
            <div class="features-grid">
                <div class="feature-card">
                    <div class="feature-icon">ðŸŽ¯</div>
                    <h3>Tailored Content</h3>
                    <p>Each cover letter is customized to match the specific job requirements and company culture.</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">âš¡</div>
                    <h3>Lightning Fast</h3>
                    <p>Generate multiple cover letters in seconds. Apply to more jobs in less time.</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">ðŸ“„</div>
                    <h3>Multiple URLs</h3>
                    <p>Process multiple job postings at once. Batch generate all your cover letters.</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">ðŸ’¾</div>
                    <h3>Auto-Save</h3>
                    <p>Cover letters automatically saved as Word documents, ready to submit.</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">ðŸ”’</div>
                    <h3>Privacy First</h3>
                    <p>Your data is secure. We don't store your resumes or job applications.</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">âœ¨</div>
                    <h3>AI-Powered</h3>
                    <p>Powered by GPT-4 to create compelling, professional cover letters.</p>
                </div>
            </div>
        </div>
    </section>

    <section id="pricing" class="pricing">
        <div class="container">
            <h2>Simple, Transparent Pricing</h2>
            <p class="pricing-subtitle">Choose the plan that works best for you</p>
            <div class="pricing-grid">
                <div class="pricing-card">
                    <div class="pricing-header">
                        <h3>Free</h3>
                        <div class="pricing-price">
                            <span class="price-amount">$0</span>
                            <span class="price-period">/month</span>
                        </div>
                    </div>
                    <ul class="pricing-features">
                        <li>âœ“ 3 cover letters per month</li>
                        <li>âœ“ AI-powered custom cover letters</li>
                        <li>âœ“ Basic templates</li>
                        <li>âœ“ Email support</li>
                    </ul>
                    <button onclick="signInWithGoogle()" class="btn-pricing">Get Started Free</button>
                </div>

                <div class="pricing-card">
                    <div class="pricing-header">
                        <h3>Monthly</h3>
                        <div class="pricing-price">
                            <span class="price-amount">$7</span>
                            <span class="price-period">/month</span>
                        </div>
                    </div>
                    <ul class="pricing-features">
                        <li>âœ“ Unlimited cover letters</li>
                        <li>âœ“ AI-powered custom cover letters</li>
                        <li>âœ“ Premium templates</li>
                        <li>âœ“ Priority support</li>
                    </ul>
                    <button onclick="signInWithGoogle()" class="btn-pricing">Start Monthly</button>
                </div>

                <div class="pricing-card featured">
                    <div class="pricing-badge">Best Value</div>
                    <div class="pricing-header">
                        <h3>Quarterly</h3>
                        <div class="pricing-price">
                            <span class="price-amount">$15</span>
                            <span class="price-period">/3 months</span>
                        </div>
                        <div class="pricing-savings">Save 29%</div>
                    </div>
                    <ul class="pricing-features">
                        <li>âœ“ Unlimited cover letters</li>
                        <li>âœ“ AI-powered custom cover letters</li>
                        <li>âœ“ Premium templates</li>
                        <li>âœ“ Priority support</li>
                        <li>âœ“ Resume optimization tips</li>
                    </ul>
                    <button onclick="signInWithGoogle()" class="btn-pricing btn-featured">Start Quarterly</button>
                </div>

                <div class="pricing-card">
                    <div class="pricing-badge best-value">Maximum Savings</div>
                    <div class="pricing-header">
                        <h3>Annual</h3>
                        <div class="pricing-price">
                            <span class="price-amount">$30</span>
                            <span class="price-period">/year</span>
                        </div>
                        <div class="pricing-savings">Save 64%</div>
                    </div>
                    <ul class="pricing-features">
                        <li>âœ“ Unlimited cover letters</li>
                        <li>âœ“ AI-powered custom cover letters</li>
                        <li>âœ“ Premium templates</li>
                        <li>âœ“ Priority support</li>
                        <li>âœ“ Resume optimization tips</li>
                    </ul>
                    <button onclick="signInWithGoogle()" class="btn-pricing">Start Annual</button>
                </div>
            </div>
        </div>
    </section>

    <footer class="footer">
        <div class="container">
            <p>&copy; 2025 BatchApply. All rights reserved.</p>
        </div>
    </footer>

    <script>
        // Initialize Supabase
        const SUPABASE_URL = 'https://igliqzsokxeknkiozkrj.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlnbGlxenNva3hla25raW96a3JqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk4MjYzNjcsImV4cCI6MjA3NTQwMjM2N30.NasThZulDuYEbRZiVsIXTMt2dLWRwtveY6_GPVULv98';

        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY, {
            auth: {
                persistSession: true,
                autoRefreshToken: true,
                detectSessionInUrl: true
            }
        });

        // Check if user is already logged in
        async function checkAuth() {
            // Check if we just logged out
            if (justLoggedOut) {
                console.log('Just logged out, skipping auth check permanently');
                return;
            }

            // Check if we're in logout mode via URL parameter
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.get('logout') === 'true') {
                console.log('Logout parameter detected, skipping auth check');
                return;
            }

            const { data: { session } } = await supabase.auth.getSession();
            console.log('checkAuth - Session:', session ? 'EXISTS' : 'NULL');
            if (session) {
                console.log('Session found, redirecting to app');
                window.location.href = '/app';
            } else {
                console.log('No session, staying on landing page');
            }
        }

        // Sign in with Google
        async function signInWithGoogle() {
            const { data, error } = await supabase.auth.signInWithOAuth({
                provider: 'google',
                options: {
                    redirectTo: window.location.origin + '/app',
                    queryParams: {
                        prompt: 'select_account'
                    }
                }
            });

            if (error) {
                console.error('Error signing in:', error);
                alert('Failed to sign in with Google. Please try again.');
            }
        }

        // Global flag to prevent auth checks after logout
        let justLoggedOut = false;

        // Check auth on page load (only if not in middle of logout)
        (async function() {
            // Check for logout URL parameter
            const urlParams = new URLSearchParams(window.location.search);
            const isLoggingOut = urlParams.get('logout') === 'true';

            console.log('=== LANDING PAGE LOADED ===');
            console.log('Current URL:', window.location.href);
            console.log('Logout parameter:', isLoggingOut);

            if (isLoggingOut) {
                // Set flag to prevent any future auth checks
                justLoggedOut = true;

                // Clear all storage and ensure logout is complete
                console.log('Logout detected, clearing all storage');

                // Clear all storage FIRST before signOut
                localStorage.clear();
                sessionStorage.clear();

                // Clear any remaining Supabase keys manually
                for (let i = localStorage.length - 1; i >= 0; i--) {
                    const key = localStorage.key(i);
                    if (key && key.startsWith('sb-')) {
                        localStorage.removeItem(key);
                    }
                }

                // Sign out from Supabase
                console.log('Calling supabase.auth.signOut()...');
                await supabase.auth.signOut({ scope: 'local' });
                console.log('SignOut completed');

                // Wait longer to ensure everything is cleared
                await new Promise(resolve => setTimeout(resolve, 500));

                // Check if session still exists
                const { data: { session } } = await supabase.auth.getSession();
                console.log('Session after signOut:', session ? 'STILL EXISTS!' : 'NULL (good)');

                // Remove logout parameter from URL WITHOUT triggering navigation
                window.history.replaceState({}, document.title, '/');

                console.log('Logout completed, all storage cleared, staying on landing page');
                console.log('justLoggedOut flag set to:', justLoggedOut);
            } else {
                console.log('No logout parameter, calling checkAuth()...');
                await checkAuth();
            }
        })();
    </script>
</body>
</html>
